<!DOCTYPE html>
<html>

<head>
    <style>
        body 
        {
            margin: 0; 
            padding: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            font-family: Arial, sans-serif; 
        }

        .tabellone-container 
        {
            display: flex;
            justify-content: center; 
            margin-top: 150px; 
            overflow-x: auto; 
            background-image: url("oca2.jpg"); 
            background-position: center; 
            background-repeat: no-repeat; 
            background-size: cover; 
            visibility: hidden; 
        }

        .tabellone-container.visibile 
        {
            visibility: visible; /* Mostra il tabellone quando il gioco inizia */
        }

        .tabellone 
        {
            display: flex; 
            flex-wrap: wrap; 
            max-width: 600px; 
        }

        .fila 
        {
            display: flex; 
            width: 100%; 
        }

        .fila.reversed 
        {
            flex-direction: row-reverse; /* Inverte la direzione della riga */
        }

        .casella 
        {
            width: 60px; /* Larghezza di ogni casella */
            height: 60px; /* Altezza di ogni casella */
            box-sizing: border-box; 
            display: flex; 
            justify-content: center;
            align-items: center; 
            font-size: 0.00001px; /* Dimensione del font praticamente invisibile */
            position: relative; /* Posizione relativa per elementi assoluti */
            border: none; /* Rimuove il bordo */
        }

        .giocatore 
        {
            font-size: 24px; /* Dimensione del font per i giocatori */
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
        }

        button 
        {
            margin: 5px; 
            padding: 10px 20px; 
            font-size: 16px; 
        }

        #bottone-giocatore 
        {
            display: none;
        }

        /* https://www.w3schools.com/howto/howto_css_modals.asp */
        .modal 
        {
            display: none; /* Nasconde il modale all'inizio */
            position: fixed; /* Posizione fissa */
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.5); 
            z-index: 9999; /* Porta il modale in primo piano */
        }

        .modal-content 
        {
            position: absolute;
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background-color: white; 
            padding: 20px; 
            border-radius: 10px; /* Angoli arrotondati */
        }
    </style>
</head>

<body class="sfondo">
    <button onclick="chiediNumeroGiocatori()">Inizia il Gioco</button> <!-- Bottone per iniziare il gioco -->
    <div class="tabellone-container">
        <div id="tabellone"></div> <!-- Contenitore per il tabellone -->
    </div>
    <div id="bottone-giocatore">
        <button onclick="muoviGiocatore()">Prossimo Giocatore</button> <!-- Bottone per muovere il giocatore -->
    </div>

    <!-- Modale per il messaggio di vittoria -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <h2 id="messaggioVittoria"></h2> <!-- Messaggio di vittoria -->
            <button onclick="chiudiModale()">Chiudi</button> <!-- Bottone per chiudere il modale -->
        </div>
    </div>

    <script>
        var numGiocatori = 0; /* Numero di giocatori */
        var posizioneGiocatori = []; /* Posizioni dei giocatori */
        var giocatoreCorrente = 0; /* Indice del giocatore corrente */
        var pedineGiocatori = ["black", "red", "blue", "purple"]; /* Colori delle pedine dei giocatori */

        function chiediNumeroGiocatori() 
        {
            numGiocatori = prompt("Inserisci il numero di giocatori (da 1 a 4):"); /* Chiede il numero di giocatori */
            if (numGiocatori < 1 || numGiocatori > 4 || isNaN(numGiocatori)) 
            {
                alert("Inserisci un numero valido di giocatori!"); /* Messaggio di errore */
                chiediNumeroGiocatori(); /* Richiede nuovamente il numero di giocatori */
            } 
            else 
            {
                document.querySelector('button').style.display = 'none'; /* Nasconde il bottone di inizio */
                generaTabellone(); /* Genera il tabellone */
                document.querySelector('.tabellone-container').classList.add('visibile'); /* Mostra il tabellone */
                document.getElementById('bottone-giocatore').style.display = 'block'; /* Mostra il bottone per muovere il giocatore */
                for (var a = 0; a < numGiocatori; a++) {
                    /* https://codyhouse.co/blog/post/javascript-append-to-array */
                    posizioneGiocatori.push(0); /* Inizializza le posizioni dei giocatori a 0 */
                }
            }
        }

        function generaTabellone() 
        {
            var tabelloneHTML = ""; /* Inizializza la variabile per l'HTML del tabellone */
            for (var i = 9; i >= 0; i--) 
            {
                if (i % 2 == 0) 
                {
                    tabelloneHTML += "<div class='fila'>"; /* Inizia una nuova riga */
                } 
                else 
                {
                    tabelloneHTML += "<div class='fila reversed'>"; /* Inizia una nuova riga invertita */
                }
                for (var j = 0; j < 10; j++) 
                {
                    var numeroCasella = i * 10 + j + 1; /* Calcola il numero della casella */
                    tabelloneHTML += "<div class='casella' data-numero='" + numeroCasella + "'></div>"; /* Aggiunge una casella al tabellone */
                }
                tabelloneHTML += "</div>"; /* Chiude la riga */
            }
            document.getElementById("tabellone").innerHTML = tabelloneHTML; /* Inserisce l'HTML del tabellone nel contenitore */
            disegnaTabellone(); /* Disegna il tabellone */
        }


        // se la pedina va su uno il 4 devi farla avanzare al numero 7. se va al 13 la fai tornare indietro alla casella numero 9. se va sulla 16 la fai tornare indietro alla 5. se va alla 23 la fai tornare alla 21. se va sulla 22 la fai avanzare alla 35. se va sulla 34 la fai avanzare alla 70. se vai sulla 24 la fai avanzare alla 99. se vai sulla 40 la fai avanzare alla 60. se vai sulla 46 la fai indietreggiare alle 42. se vai sulla 54 la fai avanzare alla 74. se vai sulla 73 la fai tornare alle 69. se vai sulla 78 la fai tornare sulla 62. se vai sulla 84 la fai andare alla 90. e se va sulla 96 la fai andare alla 94.
        function muoviGiocatore() {
            var dado = Math.floor(Math.random() * 6) + 1;
            var avanzamento = dado; // Avanzamento basato sul numero ottenuto sul dado
            alert("Il giocatore " + (giocatoreCorrente + 1) + " ha lanciato il dado! Il numero ottenuto Ã¨: " + dado);
            posizioneGiocatori[giocatoreCorrente] += avanzamento;

            // Gestione dei movimenti speciali della pedina
            switch (posizioneGiocatori[giocatoreCorrente]) 
            {
                case 4:
                    posizioneGiocatori[giocatoreCorrente] = 7;
                    break;
                case 13:
                    posizioneGiocatori[giocatoreCorrente] = 9;
                    break;
                case 16:
                    posizioneGiocatori[giocatoreCorrente] = 5;
                    break;
                case 22:
                    posizioneGiocatori[giocatoreCorrente] = 35;
                    break;
                case 23:
                    posizioneGiocatori[giocatoreCorrente] = 21;
                    break;
                case 24:
                    posizioneGiocatori[giocatoreCorrente] = 99;
                    break;
                case 34:
                    posizioneGiocatori[giocatoreCorrente] = 70;
                    break;
                case 40:
                    posizioneGiocatori[giocatoreCorrente] = 60;
                    break;
                case 46:
                    posizioneGiocatori[giocatoreCorrente] = 42;
                    break;
                case 54:
                    posizioneGiocatori[giocatoreCorrente] = 74;
                    break;
                case 73:
                    posizioneGiocatori[giocatoreCorrente] = 69;
                    break;
                case 78:
                    posizioneGiocatori[giocatoreCorrente] = 62;
                    break;
                case 84:
                    posizioneGiocatori[giocatoreCorrente] = 90;
                    break;
                case 85:
                    posizioneGiocatori[giocatoreCorrente] = 56;
                    break;
                case 96:
                    posizioneGiocatori[giocatoreCorrente] = 94;
                    break;
            }

            // Controllo se il giocatore ha vinto
            if (posizioneGiocatori[giocatoreCorrente] >= 100) 
            {
                posizioneGiocatori[giocatoreCorrente] = 100;
                document.getElementById("messaggioVittoria").textContent = "Il giocatore " + (giocatoreCorrente + 1) + " ha vinto!";
                
                apriModale();

                /* https://www.w3schools.com/js/js_timing.asp */
                //window.setTimeout(4000);
                /*for (var k = 0; k < numGiocatori; k++)
                {
                    posizioneGiocatori[k] = 0;
                }*/
            }

            // Ridisegna il tabellone con le nuove posizioni delle pedine
            disegnaTabellone();

            // Passa al prossimo giocatore
            giocatoreCorrente++;
            if (giocatoreCorrente >= numGiocatori) 
            {
                giocatoreCorrente = 0;
            }

        }


        function disegnaTabellone() 
        {
            var caselle = document.querySelectorAll('.casella'); /* Seleziona tutte le caselle */
            caselle.forEach(casella => {
                var numeroCasella = parseInt(casella.getAttribute('data-numero')); /* Ottiene il numero della casella */
                casella.innerHTML = numeroCasella; /* Imposta il numero della casella */
                casella.innerHTML += "<div class='giocatore'></div>"; /* Aggiunge un contenitore per le pedine */
            });
            for (var k = 0; k < numGiocatori; k++) 
            {
                var posizione = posizioneGiocatori[k]; /* Ottiene la posizione del giocatore */
                if (posizione > 0 && posizione <= 100) 
                {
                    var casella = document.querySelector(".casella[data-numero='" + posizione + "']"); /* Seleziona la casella corrispondente */
                    if (casella) 
                    {
                        var pedina = document.createElement('div'); /* Crea un nuovo elemento per la pedina */
                        pedina.classList.add('giocatore'); /* Aggiunge la classe 'giocatore' */
                        pedina.innerHTML = ['&#x265a;', '&#x265b;', '&#x265c;', '&#x265e;'][k]; /* Imposta il simbolo della pedina */
                        pedina.style.color = pedineGiocatori[k]; /* Imposta il colore della pedina */
                        casella.querySelector('.giocatore').appendChild(pedina); /* Aggiunge la pedina alla casella */
                    }
                }
            }
        }

        // Funzioni per il modale
        var modale = document.getElementById("myModal"); /* Seleziona il modale */

        function apriModale() {
            modale.style.display = "block"; /* Mostra il modale */
        }

        function chiudiModale() {
            modale.style.display = "none"; /* Nasconde il modale */
        }
    </script>
</body>

</html>